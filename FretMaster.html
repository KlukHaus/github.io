<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gitarren-Master: Custom Builder Edition</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #e67e22;
            --success: #27ae60;
            --error: #c0392b;
            --fret-color: #d1d1d1;
            --root-note: #f1c40f;
            --visualize: #3498db;
            --blue-note: #9b59b6;
        }
        body { font-family: 'Segoe UI', sans-serif; background: #ecf0f1; display: flex; flex-direction: column; align-items: center; padding: 20px; color: var(--primary); }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 880px; }
        
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; border-bottom: 2px solid #ddd; }
        .tab { padding: 10px 20px; cursor: pointer; background: #eee; border-radius: 8px 8px 0 0; font-weight: bold; }
        .tab.active { background: var(--primary); color: white; }

        #fretboard-container { position: relative; margin: 30px 0; display: flex; justify-content: center; }
        #fretboard { position: relative; width: 800px; height: 180px; background: #3d2b1f; border: 2px solid #222; border-radius: 4px; }
        
        .string { position: absolute; width: 100%; background: linear-gradient(to bottom, #bdc3c7, #7f8c8d); pointer-events: none; }
        .fret { position: absolute; top: 0; bottom: 0; width: 4px; background: var(--fret-color); box-shadow: -1px 0 2px rgba(0,0,0,0.5); }
        .inlay { position: absolute; width: 12px; height: 12px; background: rgba(255,255,255,0.2); border-radius: 50%; transform: translate(-50%, -50%); }

        .note-marker { 
            position: absolute; width: 22px; height: 22px; border-radius: 50%; 
            background: var(--accent); transform: translate(-50%, -50%); 
            z-index: 100; border: 2px solid white; display: flex; align-items: center;
            justify-content: center; font-size: 10px; font-weight: bold; color: white;
            transition: all 0.2s ease;
        }
        .note-marker.root { background: var(--root-note); color: #333; border: 2px solid #333; }
        .note-marker.all-pos { background: var(--visualize); box-shadow: 0 0 10px var(--visualize); }
        .note-marker.blue-note { background: var(--blue-note); box-shadow: 0 0 8px var(--blue-note); }

        #controls { display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px; margin-top: 20px; }
        button.btn { padding: 12px; font-size: 16px; font-weight: bold; cursor: pointer; background: white; border: 2px solid var(--primary); border-radius: 8px; }
        
        .menu-row { display: flex; gap: 15px; margin-bottom: 20px; align-items: center; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; }
        .range-input { width: 45px; padding: 5px; border-radius: 4px; border: 1px solid #ccc; font-weight: bold; text-align: center; }
        
        #custom-notes-box { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; background: #fff; padding: 10px; border: 1px solid #ddd; border-radius: 8px; margin-top: 10px; }
        .note-check { display: flex; align-items: center; gap: 4px; font-size: 0.9em; font-weight: bold; padding: 4px 8px; background: #eee; border-radius: 4px; cursor: pointer; }
        .note-check input { cursor: pointer; }

        .stats-bar { display: flex; justify-content: space-around; background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #ddd; }
        #timer-container { width: 100%; height: 8px; background: #eee; border-radius: 4px; margin-bottom: 15px; overflow: hidden; display: none; }
        #timer-bar { width: 100%; height: 100%; background: #e74c3c; }
        
        #scaleInfo { text-align: center; color: #555; font-size: 0.95em; margin-top: 5px; font-style: italic; }
        .hidden { display: none !important; }
        button.challenge-btn { background: #8e44ad; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="tabs">
            <div class="tab active" onclick="switchTab('quiz')">Note Quiz</div>
            <div class="tab" onclick="switchTab('scales')">Scale Explorer</div>
        </div>

        <div id="quiz-ui">
            <div class="menu-row">
                <span>Bereich: Bund 
                    <input type="number" id="minFret" class="range-input" value="0" min="0" max="12" onchange="validateRange()"> bis 
                    <input type="number" id="maxFret" class="range-input" value="12" min="0" max="12" onchange="validateRange()">
                </span>
                <label style="cursor:pointer; background: #d9eaf7; padding: 5px 10px; border-radius: 5px; font-weight: bold;">
                    <input type="checkbox" id="vizToggle"> Alle Positionen zeigen
                </label>
                <button class="challenge-btn" onclick="startChallenge()">60s Challenge Start</button>
            </div>
            <div id="timer-container"><div id="timer-bar"></div></div>
            <div class="stats-bar">
                <div>Richtig: <b id="score">0</b></div>
                <div>Streak: <b id="streak">0</b></div>
                <div id="timeDisplayContainer" style="visibility:hidden">Zeit: <b id="timeDisplay">01:00</b></div>
            </div>
            <h3 id="feedback" style="text-align:center; height: 30px;">Finde den Ton!</h3>
            <div id="controls"></div>
        </div>

        <div id="scales-ui" class="hidden">
            <div class="menu-row">
                <select id="rootSelect" onchange="updateScales()"></select>
                <select id="scaleTypeSelect" onchange="handleScaleTypeChange()">
                    <optgroup label="Standard">
                        <option value="major">Dur (Major)</option>
                        <option value="minor">NatÃ¼rlich Moll (Minor)</option>
                        <option value="pentatonicMinor">Moll Pentatonik</option>
                    </optgroup>
                    <optgroup label="Jazz & Blues">
                        <option value="blues">Blues Skala</option>
                        <option value="dorian">Dorisch</option>
                        <option value="mixo">Mixolydisch</option>
                        <option value="melodicMinor">Moll Melodisch</option>
                    </optgroup>
                    <optgroup label="Experte">
                        <option value="custom">Custom (Manuell wÃ¤hlen)</option>
                    </optgroup>
                </select>
            </div>
            
            <div id="custom-notes-box" class="hidden">
                </div>

            <p id="scaleInfo">WÃ¤hle eine Skala...</p>
        </div>

        <div id="fretboard-container">
            <div id="fretboard">
                <div id="marker-layer"></div>
            </div>
        </div>
    </div>

    <script>
        const chromaticScale = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
        const stringStartNotes = ["E", "B", "G", "D", "A", "E"]; 
        const scalePatterns = {
            major: { steps: [0, 2, 4, 5, 7, 9, 11] },
            minor: { steps: [0, 2, 3, 5, 7, 8, 10] },
            pentatonicMinor: { steps: [0, 3, 5, 7, 10] },
            blues: { steps: [0, 3, 5, 6, 7, 10], special: [6] },
            dorian: { steps: [0, 2, 3, 5, 7, 9, 10] },
            mixo: { steps: [0, 2, 4, 5, 7, 9, 10] },
            melodicMinor: { steps: [0, 2, 3, 5, 7, 9, 11] }
        };

        let currentTab = 'quiz';
        let currentQuizNote = "";
        let stats = { correct: 0, total: 0, streak: 0 };
        let challengeActive = false;
        let timerInterval;

        function init() {
            createFretboardBase();
            createQuizButtons();
            populateRootSelect();
            createCustomNoteCheckboxes();
            nextQuizQuestion();
        }

        function createFretboardBase() {
            const fb = document.getElementById('fretboard');
            for(let i=0; i<=12; i++) {
                const fret = document.createElement('div');
                fret.className = 'fret';
                fret.style.left = (i * 100/12) + "%";
                fb.appendChild(fret);
                if([3, 5, 7, 9].includes(i)) addInlay(i * 100/12 - 100/24, "50%");
                if(i === 12) { addInlay(11.5 * 100/12, "30%"); addInlay(11.5 * 100/12, "70%"); }
            }
            stringStartNotes.forEach((_, i) => {
                const s = document.createElement('div');
                s.className = 'string';
                s.style.top = (i * 100/5) + "%";
                s.style.height = (1 + i*0.5) + "px";
                fb.appendChild(s);
            });
        }

        function addInlay(left, top) {
            const dot = document.createElement('div');
            dot.className = 'inlay';
            dot.style.left = left + "%"; dot.style.top = top;
            document.getElementById('fretboard').appendChild(dot);
        }

        function createQuizButtons() {
            const ctrl = document.getElementById('controls');
            chromaticScale.forEach(note => {
                const btn = document.createElement('button');
                btn.className = 'btn'; btn.innerText = note;
                btn.onclick = () => checkQuizNote(note);
                ctrl.appendChild(btn);
            });
        }

        function populateRootSelect() {
            const sel = document.getElementById('rootSelect');
            chromaticScale.forEach(note => {
                let opt = document.createElement('option');
                opt.value = note; opt.innerText = "Grundton: " + note;
                sel.appendChild(opt);
            });
        }

        function createCustomNoteCheckboxes() {
            const box = document.getElementById('custom-notes-box');
            chromaticScale.forEach(note => {
                const label = document.createElement('label');
                label.className = 'note-check';
                label.innerHTML = `<input type="checkbox" value="${note}" onchange="updateScales()"> ${note}`;
                box.appendChild(label);
            });
        }

        function handleScaleTypeChange() {
            const type = document.getElementById('scaleTypeSelect').value;
            const customBox = document.getElementById('custom-notes-box');
            const rootSelect = document.getElementById('rootSelect');
            
            if (type === 'custom') {
                customBox.classList.remove('hidden');
                rootSelect.classList.add('hidden');
            } else {
                customBox.classList.add('hidden');
                rootSelect.classList.remove('hidden');
            }
            updateScales();
        }

        function getNoteAt(sIdx, fret) {
            let startIdx = chromaticScale.indexOf(stringStartNotes[sIdx]);
            return chromaticScale[(startIdx + fret) % 12];
        }

        function updateScales() {
            const type = document.getElementById('scaleTypeSelect').value;
            const layer = document.getElementById('marker-layer');
            layer.innerHTML = "";
            let markers = [];

            if (type === 'custom') {
                const checkedNotes = Array.from(document.querySelectorAll('#custom-notes-box input:checked')).map(i => i.value);
                for(let s=0; s<6; s++) {
                    for(let f=0; f<=12; f++) {
                        let note = getNoteAt(s, f);
                        if(checkedNotes.includes(note)) markers.push({sIdx: s, fret: f, label: note});
                    }
                }
                document.getElementById('scaleInfo').innerText = "WÃ¤hle oben TÃ¶ne aus, um sie Ã¼berall zu finden.";
            } else {
                const root = document.getElementById('rootSelect').value;
                const rootIdx = chromaticScale.indexOf(root);
                const pattern = scalePatterns[type];
                const scaleNotes = pattern.steps.map(i => chromaticScale[(rootIdx + i) % 12]);
                const specialNotes = (pattern.special || []).map(i => chromaticScale[(rootIdx + i) % 12]);
                
                for(let s=0; s<6; s++) {
                    for(let f=0; f<=12; f++) {
                        let note = getNoteAt(s, f);
                        if(scaleNotes.includes(note)) {
                            markers.push({
                                sIdx: s, fret: f, label: note, 
                                isRoot: note === root,
                                isSpecial: specialNotes.includes(note)
                            });
                        }
                    }
                }
                updateScaleDescription(type);
            }
            drawMarkers(markers);
        }

        function updateScaleDescription(type) {
            const info = document.getElementById('scaleInfo');
            const descriptions = {
                major: "Die Basis fÃ¼r alles. Fokus auf die Intervalle 3 und 7!",
                minor: "Der melancholische Standard. Gut fÃ¼r Rock-Balladen.",
                pentatonicMinor: "Das Schweizer Taschenmesser fÃ¼r Solos. Nur 5 TÃ¶ne.",
                blues: "Die Blue Note (Violett) gibt den 'schmutzigen' Charakter.",
                dorian: "Klingt 'cool' und jazzig. Denk an Carlos Santana.",
                mixo: "Perfekt Ã¼ber Blues-Akkorde. Der typische Rock-Sound.",
                melodicMinor: "Die 'Jazz-Skala'. Erzeugt Spannung und Eleganz."
            };
            info.innerHTML = `${descriptions[type]} | Grundton = <span style="color:var(--root-note); font-weight:bold">Gold</span>`;
        }

        function drawMarkers(markers) {
            const layer = document.getElementById('marker-layer');
            layer.innerHTML = "";
            markers.forEach(m => {
                const div = document.createElement('div');
                div.className = 'note-marker';
                if(m.isRoot) div.classList.add('root');
                if(m.isSpecial) div.classList.add('blue-note');
                if(m.isViz) div.classList.add('all-pos');
                
                div.style.left = (m.fret * 100/12 - (m.fret === 0 ? -1.5 : 100/24)) + "%";
                div.style.top = (m.sIdx * 100/5) + "%";
                div.innerText = m.label || "";
                layer.appendChild(div);
            });
        }

        // --- Quiz Logik ---
        function nextQuizQuestion() {
            if (currentTab !== 'quiz') return;
            const min = parseInt(document.getElementById('minFret').value);
            const max = parseInt(document.getElementById('maxFret').value);
            let sIdx = Math.floor(Math.random() * 6);
            let fret = Math.floor(Math.random() * (max - min + 1)) + min;
            currentQuizNote = getNoteAt(sIdx, fret);
            drawMarkers([{sIdx, fret, label: "", isRoot: false}]);
        }

        function checkQuizNote(clicked) {
            const isViz = document.getElementById('vizToggle').checked;
            const fb = document.getElementById('feedback');
            if(clicked === currentQuizNote) {
                stats.correct++; stats.streak++;
                fb.innerText = "Richtig! ðŸŽ‰"; fb.style.color = "var(--success)";
                if(isViz) { visualizeAll(clicked); setTimeout(nextQuizQuestion, 1200); }
                else { nextQuizQuestion(); }
            } else {
                stats.streak = 0;
                fb.innerText = "Falsch! Das war " + currentQuizNote;
                fb.style.color = "var(--error)";
                if(isViz) visualizeAll(clicked);
                if(challengeActive) setTimeout(nextQuizQuestion, 800);
            }
            updateStats();
        }

        function visualizeAll(note) {
            let markers = [];
            for(let s=0; s<6; s++) {
                for(let f=0; f<=12; f++) {
                    if(getNoteAt(s, f) === note) markers.push({sIdx: s, fret: f, label: note, isViz: true});
                }
            }
            drawMarkers(markers);
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if(event) event.target.classList.add('active');
            document.getElementById('quiz-ui').classList.toggle('hidden', tab !== 'quiz');
            document.getElementById('scales-ui').classList.toggle('hidden', tab !== 'scales');
            resetGame();
            if(tab === 'scales') handleScaleTypeChange();
        }

        function startChallenge() {
            resetGame();
            challengeActive = true;
            document.getElementById('timeDisplayContainer').style.visibility = 'visible';
            document.getElementById('timer-container').style.display = 'block';
            let timeLeft = 60;
            timerInterval = setInterval(() => {
                timeLeft -= 0.1;
                document.getElementById('timer-bar').style.width = (timeLeft/60*100) + "%";
                document.getElementById('timeDisplay').innerText = "00:" + Math.ceil(timeLeft).toString().padStart(2, '0');
                if(timeLeft <= 0) { clearInterval(timerInterval); alert("Score: " + stats.correct); resetGame(); }
            }, 100);
        }

        function resetGame() {
            clearInterval(timerInterval);
            challengeActive = false;
            document.getElementById('timeDisplayContainer').style.visibility = 'hidden';
            document.getElementById('timer-container').style.display = 'none';
            stats = { correct: 0, total: 0, streak: 0 };
            updateStats();
            nextQuizQuestion();
        }

        function updateStats() {
            document.getElementById('score').innerText = stats.correct;
            document.getElementById('streak').innerText = stats.streak;
        }

        function validateRange() {
            const min = document.getElementById('minFret');
            const max = document.getElementById('maxFret');
            if(parseInt(min.value) > parseInt(max.value)) min.value = max.value;
            resetGame();
        }

        init();
    </script>
</body>
</html>